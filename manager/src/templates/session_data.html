<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Session Data</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='general.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='session_data.css') }}">
</head>
<body>
<a href="/main_menu" class="home-button">
    <img src="{{ url_for('static', filename='photos/home.png') }}" alt="Home" class="home-icon">
</a>

<div class="session-container">
    <h1>Sessions for Lobby</h1>


    <div class="filters">
        <select id="typeFilter">
            <option value="">All Types</option>
            <option value="Water Ripples">Water Ripples</option>
            <option value="Flour Mill">Flour Mill</option>
            <option value="Wine Glasses">Wine Glasses</option>
        </select>
        <input type="date" id="dateFilter">
        <button onclick="applyFilters()">Filter</button>
    </div>

    <table id="sessionTable">
        <thead>
        <tr>
            <th>Session ID</th>
            <th>Participants</th>
            <th>Game Type</th>
            <th>Duration</th>
            <th>Date</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
  // passed in by Jinja
  const allSessions = {{ sessions|tojson }};
  const lobbyId     = "{{ lobby_id }}";

  function renderSessions(sessions) {
    const tbody = document.querySelector("#sessionTable tbody");
    tbody.innerHTML = "";

    sessions.forEach(s => {
      const date = s.timestamp ? s.timestamp.split("T")[0] : '';
      const row  = document.createElement("tr");
      row.onclick = () => {
        window.location.href = `/session_data/single?session_id=${s.sessionId}`;
      };
      row.innerHTML = `
        <td>${s.sessionId}</td>
        <td>${s.participants.join(", ")}</td>
        <td>${s.gameType}</td>
        <td>${s.duration}</td>
        <td>${date}</td>
      `;
      tbody.appendChild(row);
    });
  }

  // initialize
  document.querySelector("h1").textContent = `Sessions for Lobby #${lobbyId}`;
  renderSessions(allSessions);
</script>

</body>
</html>
